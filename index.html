<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yatrafy: End-to-End Travel AI</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & DOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* UI Polish */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        body { background-color: #fce7f3; font-family: 'Segoe UI', sans-serif; }
        
        /* Animations */
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .scan-line { animation: scan 2s linear infinite; }
        @keyframes scan { 0% { top: 0; } 50% { top: 100%; } 100% { top: 0; } }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen py-5 bg-pink-50">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS ---
        const IconStar = () => <svg className="w-3 h-3 text-yellow-400 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>;
        const IconCheck = () => <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="3" d="M5 13l4 4L19 7"/></svg>;
        const IconFile = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>;
        const IconDownload = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>;

        const YatrafyApp = () => {
            const [messages, setMessages] = useState([
                {
                    id: 1, 
                    sender: 'bot', 
                    type: 'text', 
                    content: "Hi Priya! üå¥ Ready to plan that family getaway? I recall you wanted to visit Jaipur or Kerala. Where does the family want to go?"
                }
            ]);
            const [inputPlaceholder, setInputPlaceholder] = useState("Select a destination...");
            const [isTyping, setIsTyping] = useState(false);
            const [step, setStep] = useState('START'); // START, PACE, HOTEL, ITINERARY, OFFER, BILL, PAY
            const chatEndRef = useRef(null);

            const scrollToBottom = () => chatEndRef.current?.scrollIntoView({ behavior: "smooth" });
            useEffect(() => scrollToBottom(), [messages, isTyping]);

            // --- MAIN LOGIC ENGINE ---
            const handleAction = (actionType, payload) => {
                
                // 1. DESTINATION SELECTED
                if (actionType === 'DESTINATION_JAIPUR') {
                    setStep('PACE');
                    setInputPlaceholder("Select pace...");
                    addMsg('user', 'text', "Let's go to Jaipur! üêò (2 Adults, 1 Kid)");
                    simulateThinking("Checking weather (24¬∞C) & crowd levels...", () => {
                        addMsg('bot', 'text', "Excellent choice! The weather is perfect. Since you have a 7-year-old, how do you want to pace the trip?");
                        setTimeout(() => addMsg('bot', 'pace_selector', null), 600);
                    });
                }

                // 2. PACE SELECTED
                else if (actionType === 'PACE_RELAXED') {
                    setStep('HOTEL');
                    setInputPlaceholder("Choose a hotel...");
                    addMsg('user', 'text', "Keep it Relaxed. We want to enjoy the resort.");
                    simulateThinking("Curating kid-friendly heritage stays...", () => {
                        addMsg('bot', 'text', "Got it. üßò‚Äç‚ôÄÔ∏è Here are the best resorts near Amer Fort to minimize travel time.");
                        setTimeout(() => addMsg('bot', 'hotel_carousel', null), 800);
                    });
                }

                // 3. HOTEL SELECTED
                else if (actionType === 'HOTEL_SELECTED') {
                    setStep('ITINERARY');
                    setInputPlaceholder("Reviewing plan...");
                    addMsg('user', 'text', "The Heritage Haveli looks perfect.");
                    simulateThinking("Building day-wise itinerary...", () => {
                        addMsg('bot', 'text', "I've drafted a plan mixing culture for you and fun activities for the kid.");
                        setTimeout(() => addMsg('bot', 'itinerary_card', null), 800);
                    });
                }

                // 4. ITINERARY ACCEPTED
                else if (actionType === 'ITINERARY_ACCEPTED') {
                    setStep('OFFER');
                    setInputPlaceholder("Checking offers...");
                    addMsg('user', 'text', "Looks good. Any offers?");
                    simulateThinking("Scanning credit card offers...", () => {
                        addMsg('bot', 'offer_card', null);
                    });
                }

                // 5. OFFER APPLIED -> SHOW BILL
                else if (actionType === 'APPLY_OFFER') {
                    setStep('BILL');
                    setInputPlaceholder("Ready to pay...");
                    addMsg('user', 'text', "Apply Offer & Book");
                    simulateThinking("Finalizing bookings...", () => {
                        addMsg('bot', 'bill_summary', null);
                    });
                }

                // 6. GENERATE QR
                else if (actionType === 'GENERATE_QR') {
                    setStep('PAY');
                    setInputPlaceholder("Waiting for payment...");
                    addMsg('user', 'text', "Proceed to Payment");
                    simulateThinking("Generating Secure UPI Link...", () => {
                        addMsg('bot', 'qr_code', null);
                    });
                }

                // 7. SIMULATE SCAN
                else if (actionType === 'SIMULATE_SCAN') {
                    setStep('DONE');
                    setInputPlaceholder("Trip Confirmed!");
                    setIsTyping("Verifying with Bank...");
                    setTimeout(() => {
                        setIsTyping(false);
                        addMsg('bot', 'payment_success', null);
                        setTimeout(() => addMsg('bot', 'documents', null), 1500);
                    }, 2000);
                }
            };

            const simulateThinking = (text, cb) => {
                setIsTyping(text);
                setTimeout(() => { setIsTyping(false); cb(); }, 1500);
            };

            const addMsg = (sender, type, content) => {
                setMessages(prev => [...prev, { id: Date.now(), sender, type, content }]);
            };

            // --- RENDER ---
            return (
                <div className="w-full max-w-[420px] bg-white h-[850px] border-[8px] border-gray-900 rounded-[3rem] overflow-hidden shadow-2xl relative flex flex-col font-sans mx-auto ring-4 ring-pink-200">
                    
                    {/* Header */}
                    <div className="bg-gradient-to-r from-pink-600 to-purple-600 p-5 pt-10 text-white z-10 rounded-b-[2rem] shadow-lg">
                        <div className="flex justify-between items-center">
                            <div className="flex items-center gap-2">
                                <div className="w-9 h-9 bg-white/20 rounded-full flex items-center justify-center font-bold text-lg backdrop-blur-sm">Y</div>
                                <div>
                                    <h1 className="font-bold text-md leading-tight">Yatrafy AI</h1>
                                    <p className="text-[10px] text-pink-100 opacity-80">Concierge ‚Ä¢ Family Mode</p>
                                </div>
                            </div>
                            <div className="bg-black/20 px-3 py-1 rounded-full text-[10px] font-bold backdrop-blur-md border border-white/10">
                                {step === 'DONE' ? 'Confirmed' : 'Planning...'}
                            </div>
                        </div>
                    </div>

                    {/* Chat Body */}
                    <div className="flex-1 overflow-y-auto p-4 space-y-5 bg-slate-50 relative pb-24">
                        
                        {messages.map((msg) => (
                            <div key={msg.id} className={`flex fade-in ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}>
                                
                                {msg.sender === 'bot' && <div className="w-8 h-8 bg-pink-500 rounded-full flex-shrink-0 flex items-center justify-center text-white text-[10px] mr-2 mt-1 shadow-sm">AI</div>}
                                
                                <div className={`max-w-[90%] ${msg.type === 'text' ? (msg.sender === 'user' ? 'bg-gray-800 text-white rounded-br-none' : 'bg-white text-gray-800 border border-gray-200 shadow-sm rounded-bl-none') : 'w-full'} rounded-2xl p-3 text-sm`}>
                                    
                                    {/* Text Message */}
                                    {msg.type === 'text' && <p className="leading-relaxed">{msg.content}</p>}

                                    {/* 1. PACE SELECTOR */}
                                    {msg.type === 'pace_selector' && (
                                        <div className="flex gap-2 mt-1">
                                            <button onClick={() => handleAction('PACE_RELAXED')} className="flex-1 bg-green-50 border border-green-200 p-3 rounded-xl hover:bg-green-100 transition text-left group">
                                                <span className="text-xl group-hover:scale-110 block transition">üßò‚Äç‚ôÄÔ∏è</span>
                                                <span className="text-xs font-bold text-green-800 block mt-1">Relaxed</span>
                                                <span className="text-[10px] text-green-600 leading-tight">Sleep in, 1 major spot/day</span>
                                            </button>
                                            <button className="flex-1 bg-gray-50 border border-gray-200 p-3 rounded-xl opacity-60 text-left cursor-not-allowed">
                                                <span className="text-xl">üéí</span>
                                                <span className="text-xs font-bold text-gray-600 block mt-1">Packed</span>
                                                <span className="text-[10px] text-gray-400 leading-tight">See everything</span>
                                            </button>
                                        </div>
                                    )}

                                    {/* 2. HOTEL CAROUSEL */}
                                    {msg.type === 'hotel_carousel' && (
                                        <div className="flex overflow-x-auto gap-3 pb-2 no-scrollbar -mx-1 px-1">
                                            {/* Hotel 1 */}
                                            <div className="min-w-[220px] bg-white rounded-xl overflow-hidden border border-gray-200 shadow-md">
                                                <div className="h-28 bg-rose-100 relative flex items-center justify-center text-rose-300 font-bold">
                                                    IMAGE
                                                    <div className="absolute top-2 right-2 bg-white px-2 py-0.5 rounded-full text-[10px] font-bold shadow text-gray-800">For Families</div>
                                                </div>
                                                <div className="p-3">
                                                    <div className="flex justify-between items-start">
                                                        <h3 className="font-bold text-gray-800">Heritage Haveli</h3>
                                                        <span className="flex items-center text-[10px] bg-green-100 text-green-700 px-1 rounded">4.8 <IconStar/></span>
                                                    </div>
                                                    <p className="text-[10px] text-gray-500 mt-1">2km from Amer Fort ‚Ä¢ Pool</p>
                                                    <div className="flex justify-between items-end mt-3 border-t pt-2">
                                                        <div><span className="font-bold text-pink-600">‚Çπ8,500</span><span className="text-[10px] text-gray-400">/night</span></div>
                                                        <button onClick={() => handleAction('HOTEL_SELECTED')} className="bg-pink-600 text-white px-3 py-1 rounded-lg text-xs font-bold shadow-md hover:bg-pink-700">Select</button>
                                                    </div>
                                                </div>
                                            </div>
                                            {/* Hotel 2 (Dummy) */}
                                            <div className="min-w-[220px] bg-white rounded-xl overflow-hidden border border-gray-200 opacity-60">
                                                <div className="h-28 bg-gray-200 flex items-center justify-center text-gray-400">IMAGE</div>
                                                <div className="p-3">
                                                    <h3 className="font-bold text-gray-600">Fairmont Jaipur</h3>
                                                    <div className="mt-6 flex justify-between items-end">
                                                        <span className="font-bold text-gray-500">‚Çπ14,000</span>
                                                        <button className="bg-gray-100 text-gray-400 px-3 py-1 rounded-lg text-xs font-bold">Select</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {/* 3. ITINERARY CARD */}
                                    {msg.type === 'itinerary_card' && (
                                        <div className="bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden">
                                            <div className="bg-gray-50 p-3 border-b flex justify-between items-center">
                                                <h3 className="font-bold text-gray-800 text-xs">Day 1 Plan (Relaxed)</h3>
                                                <span className="text-[10px] text-gray-400">Tue, 24 Oct</span>
                                            </div>
                                            <div className="p-3 relative">
                                                <div className="absolute left-[19px] top-6 bottom-6 w-0.5 bg-gray-200"></div>
                                                
                                                <div className="flex gap-3 mb-4 relative z-10">
                                                    <div className="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center text-lg shadow-sm border border-white">üè∞</div>
                                                    <div className="flex-1">
                                                        <div className="flex justify-between"><h4 className="font-bold text-xs text-gray-800">Amer Fort</h4><span className="text-[10px] text-gray-400">10:00 AM</span></div>
                                                        <p className="text-[10px] text-gray-500">Elephant ride booked.</p>
                                                    </div>
                                                </div>
                                                <div className="flex gap-3 relative z-10">
                                                    <div className="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-lg shadow-sm border border-white">üèä</div>
                                                    <div className="flex-1">
                                                        <div className="flex justify-between"><h4 className="font-bold text-xs text-gray-800">Resort Pool Time</h4><span className="text-[10px] text-gray-400">03:00 PM</span></div>
                                                        <p className="text-[10px] text-gray-500">Relaxing afternoon.</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <button onClick={() => handleAction('ITINERARY_ACCEPTED')} className="w-full bg-gray-900 text-white py-2 text-xs font-bold hover:bg-black">Looks Perfect</button>
                                        </div>
                                    )}

                                    {/* 4. OFFER CARD */}
                                    {msg.type === 'offer_card' && (
                                        <div className="bg-gradient-to-r from-purple-500 to-indigo-600 rounded-xl p-4 text-white shadow-lg relative overflow-hidden">
                                            <div className="flex justify-between items-start mb-2">
                                                <div>
                                                    <span className="bg-yellow-400 text-purple-900 text-[9px] font-bold px-1.5 py-0.5 rounded">BEST DEAL</span>
                                                    <h3 className="font-bold mt-1 text-sm">Family Pack</h3>
                                                </div>
                                                <span className="text-2xl">üéâ</span>
                                            </div>
                                            <p className="text-[11px] text-purple-100 mb-3">Includes Flights + Stay + Breakfast.</p>
                                            <div className="flex justify-between items-center border-t border-white/20 pt-2">
                                                <div><span className="text-[10px] line-through text-purple-300">‚Çπ32,000</span><div className="font-bold text-lg">‚Çπ28,500</div></div>
                                                <button onClick={() => handleAction('APPLY_OFFER')} className="bg-white text-purple-600 px-4 py-1.5 rounded-lg text-xs font-bold shadow-sm hover:bg-gray-50">Book Now</button>
                                            </div>
                                        </div>
                                    )}

                                    {/* 5. BILL SUMMARY */}
                                    {msg.type === 'bill_summary' && (
                                        <div className="bg-white rounded-xl p-4 border border-gray-200 shadow-sm">
                                            <h3 className="font-bold text-gray-800 border-b pb-2 mb-2">Final Summary</h3>
                                            <div className="space-y-1 text-xs text-gray-600 mb-3">
                                                <div className="flex justify-between"><span>Flights (3 Pax)</span><span>‚Çπ12,000</span></div>
                                                <div className="flex justify-between"><span>Haveli (2 Nights)</span><span>‚Çπ17,000</span></div>
                                                <div className="flex justify-between text-green-600"><span>Offer Discount</span><span>-‚Çπ3,500</span></div>
                                                <div className="flex justify-between text-gray-900 font-bold border-t pt-1 mt-1"><span>Total Pay</span><span>‚Çπ25,500</span></div>
                                            </div>
                                            <button onClick={() => handleAction('GENERATE_QR')} className="w-full bg-black text-white py-3 rounded-lg text-xs font-bold">Proceed to Payment</button>
                                        </div>
                                    )}

                                    {/* 6. QR CODE */}
                                    {msg.type === 'qr_code' && (
                                        <div className="bg-white rounded-xl overflow-hidden border border-gray-200 shadow-md">
                                            <div className="bg-gray-50 p-2 text-center border-b"><p className="text-xs text-gray-500">Scan via UPI</p></div>
                                            <div className="p-4 flex justify-center bg-white relative">
                                                <div className="border-4 border-gray-900 p-2 rounded-lg relative">
                                                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay?pa=yatrafy@upi&pn=Yatrafy" alt="QR" className="w-28 h-28 opacity-90"/>
                                                    <div className="absolute left-0 w-full h-0.5 bg-red-500 shadow-[0_0_8px_red] scan-line opacity-60"></div>
                                                </div>
                                            </div>
                                            <button onClick={() => handleAction('SIMULATE_SCAN')} className="w-full bg-green-50 text-green-700 py-2 text-xs font-bold border-t border-green-100">Simulate Scan (Demo)</button>
                                        </div>
                                    )}

                                    {/* 7. SUCCESS */}
                                    {msg.type === 'payment_success' && (
                                        <div className="bg-green-600 text-white p-5 rounded-xl text-center shadow-lg">
                                            <div className="w-10 h-10 bg-white rounded-full flex items-center justify-center mx-auto mb-2 text-green-600"><IconCheck /></div>
                                            <h2 className="font-bold text-lg">Booked!</h2>
                                            <p className="text-xs text-green-100">Trip ID: #JAIPUR-8821</p>
                                        </div>
                                    )}

                                    {/* 8. DOCUMENTS */}
                                    {msg.type === 'documents' && (
                                        <div className="bg-white rounded-xl border border-gray-200 shadow-md overflow-hidden">
                                            <div className="p-3 bg-gray-50 border-b"><h3 className="font-bold text-gray-800 text-xs">Downloads</h3></div>
                                            <div className="divide-y divide-gray-100">
                                                <div className="p-3 flex items-center justify-between hover:bg-gray-50 cursor-pointer group">
                                                    <div className="flex items-center gap-2"><div className="bg-red-100 p-1.5 rounded text-red-500"><IconFile/></div><span className="text-xs font-bold text-gray-700">Tickets.pdf</span></div>
                                                    <span className="text-gray-400 group-hover:text-pink-600"><IconDownload/></span>
                                                </div>
                                                <div className="p-3 flex items-center justify-between hover:bg-gray-50 cursor-pointer group">
                                                    <div className="flex items-center gap-2"><div className="bg-purple-100 p-1.5 rounded text-purple-500"><IconFile/></div><span className="text-xs font-bold text-gray-700">Itinerary.pdf</span></div>
                                                    <span className="text-gray-400 group-hover:text-pink-600"><IconDownload/></span>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                </div>
                            </div>
                        ))}

                        {/* Typing Animation */}
                        {isTyping && (
                            <div className="flex justify-start fade-in pl-2">
                                <div className="w-8 h-8 bg-pink-500 rounded-full flex items-center justify-center text-white text-[10px] mr-2">AI</div>
                                <div className="bg-gray-100 rounded-2xl p-3 text-xs text-gray-500 flex items-center gap-2">
                                    <div className="w-2 h-2 bg-pink-400 rounded-full animate-ping"></div>
                                    {isTyping}
                                </div>
                            </div>
                        )}
                        <div ref={chatEndRef} />
                    </div>

                    {/* Input Area */}
                    <div className="bg-white p-3 border-t z-20 absolute bottom-0 w-full rounded-b-[2.5rem]">
                        
                        {/* SUGGESTION CHIPS (Only at Start) */}
                        {step === 'START' && (
                            <div className="flex gap-2 overflow-x-auto mb-3 pb-1 no-scrollbar">
                                <button onClick={() => handleAction('DESTINATION_JAIPUR')} className="flex items-center gap-1 whitespace-nowrap bg-pink-50 text-pink-700 px-3 py-1.5 rounded-full text-xs font-bold border border-pink-100 shadow-sm hover:bg-pink-100">
                                    üè∞ Jaipur Family Trip
                                </button>
                                <button className="whitespace-nowrap bg-green-50 text-green-700 px-3 py-1.5 rounded-full text-xs font-bold border border-green-100 shadow-sm opacity-60">
                                    üå¥ Kerala
                                </button>
                            </div>
                        )}
                        
                        <div className="flex gap-2 items-center bg-gray-50 px-4 py-3 rounded-full border focus-within:ring-2 ring-pink-400 transition-all">
                            <input 
                                type="text" 
                                value=""
                                placeholder={inputPlaceholder}
                                className="bg-transparent flex-1 outline-none text-sm text-gray-700 placeholder-gray-400"
                                readOnly
                            />
                            <div className={`p-2 rounded-full text-white shadow-md transition-colors ${step === 'DONE' ? 'bg-green-500' : 'bg-pink-500'}`}>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                            </div>
                        </div>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<YatrafyApp />);
    </script>
</body>
</html>
